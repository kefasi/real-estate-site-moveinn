<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Property Details - MoveInn</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap">
</script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header -->
  <header class="bg-white shadow p-4">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <h1 class="text-2xl font-bold text-blue-600">MoveInn</h1>
      <a href="listings.html" class="text-blue-600 hover:underline">Back to Listings</a>
    </div>
  </header>

  <main class="max-w-6xl mx-auto p-6 space-y-12">

    <!-- Property Overview -->
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
      <img id="property-image" src="" alt="Property" class="w-full h-64 object-cover" />
      <div class="p-6">
        <h2 id="property-title" class="text-2xl font-semibold mb-2"></h2>
        <p id="property-description" class="text-gray-700 mb-4"></p>
        <p id="property-price" class="text-lg font-bold text-blue-600 mb-6"></p>

       
          <h3 class="text-xl font-semibold mb-4">üñº Property Images</h3>
          <div class="flex space-x-4 overflow-x-auto">
            <div id="property-images-thumbnails" class="flex space-x-4">
              <!-- Dynamically loaded thumbnail images will appear here -->
           
          </div>
        </div>
  
        <!-- Details and Amenities Side by Side -->
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Amenities -->
          <div>
            <h3 class="text-xl font-semibold mb-2">üè° Amenities</h3>
            <ul id="property-amenities" class="list-disc list-inside text-gray-700 space-y-1"></ul>
          </div>
  
          <!-- Additional Details -->
          <div>
            <h3 class="text-xl font-semibold mb-2">üìã More Details</h3>
            <div id="property-details" class="text-gray-700 space-y-1">
              <!-- Populated dynamically -->
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Image Thumbnails -->
  
  
    <!-- Virtual Tour & Map Section -->
    <div class="grid md:grid-cols-2 gap-6">
      <!-- 3D Walkthrough -->
      <div class="bg-white p-6 rounded-2xl shadow-lg">
        <h3 class="text-xl font-semibold mb-4">üåÄ Virtual Walkthrough</h3>
        <div class="h-64 bg-gray-100 flex items-center justify-center text-gray-500">
          <!-- Placeholder for 3D content -->
          Coming Soon...
        </div>
      </div>
  
      <!-- Map -->
      <div class="bg-white p-6 rounded-2xl shadow-lg">
        <h3 class="text-xl font-semibold mb-4">üìç Location</h3>
        <div id="map-container" class="w-full h-[950px] md:h-[700px] rounded-xl overflow-hidden">
          <!-- Map iframe will be inserted via JS -->
        </div>
      </div>
    </div>
    <aside class="space-y-4">
      <div class="bg-white p-4 rounded-2xl shadow">
        <h3 class="text-xl font-semibold mb-4">üèò You May Also Like</h3>
        <div id="recommendations" class="space-y-4 text-sm text-gray-800"></div>
      </div>
    </aside>

  
  </main>

  <script>
    
    const urlParams = new URLSearchParams(window.location.search);
const propertyId = urlParams.get('id');

fetch('properties.json')
  .then(response => response.json())
  .then(properties => {
    const property = properties.find(p => p.id == propertyId);

    if (!property) {
      document.getElementById('property-container').innerHTML = "<p class='text-red-600'>Property not found.</p>";
      return;
    }

    // Populate main fields
    document.getElementById('property-image').src = property.image;
    document.getElementById('property-title').textContent = property.title;
    document.getElementById('property-description').textContent = property.description;
    document.getElementById('property-price').textContent = property.price;

    // Populate amenities
    const amenitiesList = document.getElementById('property-amenities');
    amenitiesList.innerHTML = "";
    property.amenities.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item;
      amenitiesList.appendChild(li);
    });

    // Populate details
    const detailsDiv = document.getElementById('property-details');
    for (const [key, value] of Object.entries(property.details)) {
      const p = document.createElement('p');
      p.textContent = `${key}: ${value}`;
      detailsDiv.appendChild(p);
    }

    // Populate thumbnails
    const thumbnailsContainer = document.getElementById('property-images-thumbnails');
    if (property.images && property.images.length > 0) {
      property.images.forEach(imgSrc => {
        const img = document.createElement('img');
        img.src = imgSrc;
        img.alt = "Property Thumbnail";
        img.className = "w-24 h-24 object-cover rounded-lg cursor-pointer";
        img.onclick = function() {
          document.getElementById('property-image').src = imgSrc;
        };
        thumbnailsContainer.appendChild(img);
      });
    }

    // Show map via iframe
    const mapContainer = document.getElementById('map-container');
    if (property.location) {
      let mapSrc = "";

      if (property.location.lat && property.location.lng) {
        mapSrc = `https://maps.google.com/maps?q=${property.location.lat},${property.location.lng}&z=15&output=embed`;
      } else if (property.location.address) {
        const encodedAddress = encodeURIComponent(property.location.address);
        mapSrc = `https://maps.google.com/maps?q=${encodedAddress}&z=15&output=embed`;
      }

      mapContainer.innerHTML = `
        <iframe
          src="${mapSrc}"
          width="100%"
          height="100%"
          style="border:0;"
          allowfullscreen=""
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade">
        </iframe>
      `;
    } else {
      mapContainer.innerHTML = "<p class='text-center text-gray-600'>Map location not available.</p>";
    }
 

   // Smart Recommendations
   const recommendations = document.getElementById('recommendations');

// Filter out the current property
let otherProperties = properties.filter(p => p.id != property.id);

// Match by location and type
let smartMatches = otherProperties.filter(p =>
  p.details["Location"]?.toLowerCase().includes(property.details["Location"]?.toLowerCase()) ||
  p.details["Property Type"] === property.details["Property Type"]
);

// If not enough smart matches, add random ones
if (smartMatches.length < 3) {
  // Shuffle remaining
  const shuffled = otherProperties
    .filter(p => !smartMatches.includes(p))
    .sort(() => 0.5 - Math.random());

  smartMatches = [...smartMatches, ...shuffled.slice(0, 3 - smartMatches.length)];
} else {
  smartMatches = smartMatches.slice(0, 3); // Limit to 3
}

// Display the recommendations
smartMatches.forEach(rec => {
  const card = document.createElement('div');
  card.className = "flex items-start gap-4";

  card.innerHTML = `
    <img src="${rec.image}" alt="Recommended Property" class="w-20 h-16 object-cover rounded" />
    <div>
      <h4 class="font-semibold">${rec.title}</h4>
      <p class="text-sm text-blue-600 font-bold">${rec.price}</p>
      <a href="property.html?id=${rec.id}" class="text-blue-500 hover:underline text-xs">View</a>
    </div>
  `;

  recommendations.appendChild(card);
});
    })

    fetch('properties.json')
  .then(response => response.json())
  .then(data => {
    const currentId = Number(new URLSearchParams(window.location.search).get('id'));
    const current = data.find(p => p.id === currentId);

    if (!current) return;

    const recommendationsContainer = document.getElementById('recommendations');
    recommendationsContainer.innerHTML = "";

    const currentPrice = parseInt(current.price.replace(/[^0-9]/g, ''));
    const currentNeighborhood = current.location?.neighborhood?.toLowerCase() || "";

    const scored = data
      .filter(p => p.id !== currentId)
      .map(p => {
        let score = 0;
        let reasons = [];

        // Match by Property Type
        if (p.details["Property Type"] === current.details["Property Type"]) {
          score += 2;
          reasons.push("Type");
        }

        // Match by Location (same address prefix)
        if (p.location?.address?.includes(current.location?.address?.split(",")[0])) {
          score += 2;
          reasons.push("Location");
        }

        // Match by Price Range (¬±15%)
        const pPrice = parseInt(p.price.replace(/[^0-9]/g, ''));
        if (Math.abs(currentPrice - pPrice) <= currentPrice * 0.15) {
          score += 1;
          reasons.push("Price");
        }

        // Match by Neighborhood
        const pNeighborhood = p.location?.neighborhood?.toLowerCase() || "";
        if (currentNeighborhood && currentNeighborhood === pNeighborhood) {
          score += 1;
          reasons.push("Neighborhood");
        }

        return { ...p, score, reasons };
      })
      .filter(p => p.score > 0)
      .sort((a, b) => b.score - a.score)
      .slice(0, 3);

    scored.forEach(property => {
      const badges = property.reasons.map(reason => {
        let colorClass = "bg-gray-100 text-gray-700";
        if (reason === "Type") colorClass = "bg-blue-100 text-blue-700";
        else if (reason === "Location") colorClass = "bg-purple-100 text-purple-700";
        else if (reason === "Price") colorClass = "bg-green-100 text-green-700";
        else if (reason === "Neighborhood") colorClass = "bg-yellow-100 text-yellow-700";

        return `<span class="inline-block ${colorClass} text-sm px-2 py-1 rounded mr-1 mb-1">Matched by: ${reason}</span>`;
      }).join('');

      const card = document.createElement('div');
      card.className = "bg-white rounded-xl shadow p-4";
      card.innerHTML = `
        <img src="${property.image}" class="h-40 w-full object-cover rounded-md mb-2">
        <h4 class="font-semibold text-lg">${property.title}</h4>
        <p class="text-gray-600 mb-2">${property.price}</p>
        <div class="mb-2">${badges}</div>
        <a href="property.html?id=${property.id}" class="inline-block mt-2 text-blue-600 hover:underline">View Property</a>
      `;
      recommendationsContainer.appendChild(card);
    });
  })
  .catch(error => {
    console.error('Error loading property:', error);
  });


 </script>
</body>
</html>
